<!DOCTYPE html>
<html
  lang="en"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout}"
>
  <head>
    <meta charset="UTF-8" />
    <title>Title</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Basis Grotesque Pro", -apple-system, Roboto, Helvetica,
          sans-serif;
        font-size: 1rem;
      }

      .tab-active {
        color: #0c74b1 !important;
        border-bottom: 0.125rem solid #0c74b1 !important;
        background-color: #f4f8fb !important;
        font-weight: 500 !important;
      }

      .tab-inactive {
        color: #8a8f92 !important;
        font-weight: 400 !important;
      }

      .status-active {
        color: #46a14b;
        border-radius: 6.25rem;
        border: 0.0625rem solid #46a14b;
        padding: 0.5rem 1rem;
        background-color: #f4faf5;
        display: inline-block;
        font-size: 0.875rem;
        font-weight: 400;
        text-align: center;
        min-width: 4rem;
      }

      .status-disabled {
        color: #ff3b30;
        border-radius: 6.25rem;
        border: 0.0625rem solid #ff3b30;
        padding: 0.5rem 1rem;
        background-color: #fff1f0;
        display: inline-block;
        font-size: 0.875rem;
        font-weight: 400;
        text-align: center;
        min-width: 4rem;
      }

      .status-enabled {
        color: #46a14b;
        border-radius: 6.25rem;
        border: 0.0625rem solid #46a14b;
        padding: 0.5rem 1rem;
        background-color: #f4faf5;
        display: inline-block;
        font-size: 0.875rem;
        font-weight: 400;
        text-align: center;
        min-width: 4rem;
      }

      .btn-primary-inactive {
        background-color: #cfe5f2 !important;
        border-color: #cfe5f2 !important;
        color: #6c757d !important;
        cursor: not-allowed !important;
      }

      .btn-primary-active {
        background-color: #0c74b1 !important;
        border-color: #0c74b1 !important;
        color: #fff !important;
      }

      .btn-primary-active:hover {
        background-color: #0a5d8f !important;
      }

      .btn-cancel {
        background: transparent !important;
        border: 0.0625rem solid #000 !important;
        color: #000 !important;
      }

      .btn-cancel:hover {
        background-color: #f8f9fa !important;
      }

      .action-button-disabled {
        border: none !important;
        background: none !important;
        cursor: not-allowed !important;
        opacity: 0.5 !important;
      }

      .toggle-switch {
        position: relative;
        display: inline-block;
        width: 2.5rem;
        height: 1.25rem;
      }

      .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: 0.4s;
        border-radius: 1.25rem;
      }

      .toggle-slider:before {
        position: absolute;
        content: "";
        height: 1rem;
        width: 1rem;
        left: 0.125rem;
        bottom: 0.125rem;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
      }

      input:checked + .toggle-slider {
        background-color: #0c74b1;
      }

      input:checked + .toggle-slider:before {
        transform: translateX(1.25rem);
      }

      .action-dropdown {
        position: relative;
      }

      .dropdown-menu {
        min-width: 10rem;
      }

      .dropdown-item.text-danger:hover {
        background-color: #f8d7da;
      }

      .pagination-nav {
        display: flex;
        align-items: center;
        gap: 1rem;
        font-size: 0.875rem;
        color: #8a8f92;
        font-weight: 400;
        white-space: nowrap;
        line-height: 1.6;
        justify-content: center;
      }

      .pagination-arrow {
        width: 1.5625rem;
        height: 1.5625rem;
        cursor: pointer;
      }

      .pagination-numbers {
        display: flex;
        align-items: center;
        gap: 0.3125rem;
      }

      .page-number {
        border-radius: 0.125rem;
        padding: 0.25rem 0.5rem;
        cursor: pointer;
        min-width: 1.375rem;
        text-align: center;
      }

      .page-number.active {
        color: #f4f8fb;
        background-color: #0c74b1;
      }

      .page-number:not(.active) {
        color: #8a8f92;
      }

      .page-dots {
        color: #8a8f92;
        font-size: 0.75rem;
        padding: 0.25rem;
      }

      .cursor-pointer {
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div layout:fragment="content">
      <div class="container-fluid">
        <!-- Tab Navigation -->
        <div class="mt-3 px-4">
          <div
            class="d-flex align-items-center border-bottom"
            style="border-color: #b0b3b5 !important"
          >
            <div class="tab-active px-4 py-2 cursor-pointer" id="usersTab">
              Users
            </div>
            <div class="tab-inactive px-4 py-2 cursor-pointer" id="rolesTab">
              Roles and Permissions
            </div>
          </div>
        </div>

        <!-- Content Container -->
        <div class="px-4 py-3">
          <div class="container-fluid">
            <!-- Total Count -->
            <div
              class="d-flex align-items-center border-bottom pb-2 mb-3"
              style="border-color: #e6e7e7 !important"
            >
              <span class="text-dark">
                <span style="font-size: 1rem; text-transform: capitalize"
                  >Total:</span
                >
                <span class="fw-medium" id="totalCount">50</span>
              </span>
            </div>

            <!-- Controls Row -->
            <div class="row align-items-center mb-4">
              <div class="col-md-6">
                <div class="input-group" style="max-width: 300px">
                  <span
                    class="input-group-text bg-white border-end-0"
                    style="border-color: #b0b3b5"
                  >
                    <i class="fas fa-search text-muted"></i>
                  </span>
                  <input
                    type="text"
                    class="form-control border-start-0"
                    id="searchInput"
                    placeholder="Search by name"
                    style="border-color: #b0b3b5"
                  />
                </div>
              </div>
              <div class="col-md-6 text-end">
                <button
                  class="btn btn-primary d-inline-flex align-items-center gap-2"
                  id="addButton"
                  style="background-color: #0c74b1; border-color: #0c74b1"
                >
                  <i class="fas fa-plus"></i>
                  <span id="addButtonText">Add User</span>
                </button>
              </div>
            </div>

            <!-- Users Table -->
            <div id="usersTable">
              <div class="table-responsive">
                <table class="table table-borderless">
                  <thead>
                    <tr
                      class="border-bottom"
                      style="border-color: #b0b3b5 !important"
                    >
                      <th class="fw-normal text-dark py-3" style="width: 20%">
                        Name
                      </th>
                      <th class="fw-normal text-dark py-3" style="width: 25%">
                        Email Address
                      </th>
                      <th class="fw-normal text-dark py-3" style="width: 15%">
                        Role
                      </th>
                      <th class="fw-normal text-dark py-3" style="width: 15%">
                        Date Added
                      </th>
                      <th class="fw-normal text-dark py-3" style="width: 15%">
                        Status
                      </th>
                      <th class="fw-normal text-dark py-3" style="width: 10%">
                        Action
                      </th>
                    </tr>
                  </thead>
                  <tbody id="usersTableBody">
                    <!-- User rows will be populated here -->
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Roles Table -->
            <div id="rolesTable" class="d-none">
              <div class="table-responsive">
                <table class="table table-borderless">
                  <thead>
                    <tr
                      class="border-bottom"
                      style="border-color: #b0b3b5 !important"
                    >
                      <th class="fw-normal text-dark py-3" style="width: 20%">
                        Role
                      </th>
                      <th class="fw-normal text-dark py-3" style="width: 30%">
                        Description
                      </th>
                      <th class="fw-normal text-dark py-3" style="width: 10%">
                        Users
                      </th>
                      <th class="fw-normal text-dark py-3" style="width: 15%">
                        Date Created
                      </th>
                      <th class="fw-normal text-dark py-3" style="width: 15%">
                        Status
                      </th>
                      <th class="fw-normal text-dark py-3" style="width: 10%">
                        Action
                      </th>
                    </tr>
                  </thead>
                  <tbody id="rolesTableBody">
                    <!-- Role rows will be populated here -->
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Pagination -->
            <div class="pagination-nav mt-4">
              <i class="fas fa-chevron-left pagination-arrow" id="prevPage"></i>
              <div class="pagination-numbers">
                <div class="page-number active">1</div>
                <div class="page-number">2</div>
                <div class="page-number">3</div>
                <div class="page-dots">....</div>
                <div class="page-number">10</div>
              </div>
              <i
                class="fas fa-chevron-right pagination-arrow"
                id="nextPage"
              ></i>
            </div>
          </div>
        </div>
      </div>

      <!-- Add/Edit User Modal -->
      <div
        class="modal fade"
        id="userModal"
        tabindex="-1"
        aria-labelledby="userModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="userModalLabel">Add New User</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <form id="userForm">
                <div class="mb-3">
                  <label for="firstName" class="form-label fw-medium"
                    >First Name</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="firstName"
                    placeholder="Enter first name"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="lastName" class="form-label fw-medium"
                    >Last Name</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="lastName"
                    placeholder="Enter last name"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="email" class="form-label fw-medium"
                    >Email Address</label
                  >
                  <input
                    type="email"
                    class="form-control"
                    id="email"
                    placeholder="Enter email address"
                    required
                  />
                  <div class="invalid-feedback" id="emailError"></div>
                </div>
                <div class="mb-3">
                  <label for="role" class="form-label fw-medium"
                    >Select Role</label
                  >
                  <select class="form-select" id="role" required>
                    <option value="">Choose role...</option>
                    <option value="Admin">Admin</option>
                    <option value="Guest">Guest</option>
                  </select>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-cancel"
                data-bs-dismiss="modal"
              >
                Cancel
              </button>
              <button
                type="button"
                class="btn btn-primary-inactive"
                id="saveUserBtn"
              >
                Add User
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Add/Edit Role Modal -->
      <div
        class="modal fade"
        id="roleModal"
        tabindex="-1"
        aria-labelledby="roleModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="roleModalLabel">Create New Role</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <form id="roleForm">
                <div class="mb-3">
                  <label for="roleName" class="form-label fw-medium"
                    >Role Name</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="roleName"
                    placeholder="Enter role name"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="roleDescription" class="form-label fw-medium"
                    >Description</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="roleDescription"
                    placeholder="Enter description"
                    required
                  />
                </div>
                <div class="mb-3">
                  <div class="accordion" id="permissionsAccordion">
                    <div class="accordion-item">
                      <h2 class="accordion-header" id="permissionsHeading">
                        <button
                          class="accordion-button collapsed"
                          type="button"
                          data-bs-toggle="collapse"
                          data-bs-target="#permissionsCollapse"
                          aria-expanded="false"
                          aria-controls="permissionsCollapse"
                        >
                          User Management
                        </button>
                      </h2>
                      <div
                        id="permissionsCollapse"
                        class="accordion-collapse collapse"
                        aria-labelledby="permissionsHeading"
                        data-bs-parent="#permissionsAccordion"
                      >
                        <div class="accordion-body">
                          <div class="form-check mb-3">
                            <input
                              class="form-check-input"
                              type="checkbox"
                              id="canDisableUser"
                              checked
                            />
                            <label
                              class="form-check-label"
                              for="canDisableUser"
                            >
                              Can Disable User
                            </label>
                          </div>
                          <div class="form-check mb-3">
                            <input
                              class="form-check-input"
                              type="checkbox"
                              id="canAddUser"
                              checked
                            />
                            <label class="form-check-label" for="canAddUser">
                              Can Add New User
                            </label>
                          </div>
                          <div class="form-check">
                            <input
                              class="form-check-input"
                              type="checkbox"
                              id="canDeleteUser"
                              checked
                            />
                            <label class="form-check-label" for="canDeleteUser">
                              Can Delete User
                            </label>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-cancel"
                data-bs-dismiss="modal"
              >
                Cancel
              </button>
              <button
                type="button"
                class="btn btn-primary-inactive"
                id="saveRoleBtn"
              >
                Create
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Delete Confirmation Modal -->
      <div
        class="modal fade"
        id="deleteModal"
        tabindex="-1"
        aria-labelledby="deleteModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="deleteModalLabel">Confirm Delete</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body text-center">
              <i
                class="fas fa-trash text-danger mb-3"
                style="font-size: 3rem"
              ></i>
              <p class="text-muted" id="deleteText">
                Once deleted, you cannot access the user again
              </p>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-cancel"
                data-bs-dismiss="modal"
              >
                Cancel
              </button>
              <button
                type="button"
                class="btn btn-danger"
                id="confirmDeleteBtn"
              >
                Delete
              </button>
            </div>
          </div>
        </div>
      </div>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
      <script>
        // Global variables
        let currentTab = "users";
        let editingUserId = null;
        let editingRoleId = null;
        let deleteTarget = null;
        let deleteType = null;

        // Initialize data
        let users = [
          {
            id: 1,
            firstName: "Adedapo",
            lastName: "Tiamiyu",
            email: "tiamiyuadedapo@gmail.com",
            role: "Super Admin",
            dateAdded: "Mar 27, 2025",
            status: "Active",
          },
          {
            id: 2,
            firstName: "Adedapo",
            lastName: "Tiamiyu",
            email: "tiamiyuadedapo@gmail.com",
            role: "Admin",
            dateAdded: "Mar 27, 2025",
            status: "Active",
          },
          {
            id: 3,
            firstName: "Adedapo",
            lastName: "Tiamiyu",
            email: "tiamiyuadedapo@gmail.com",
            role: "Admin",
            dateAdded: "Mar 27, 2025",
            status: "Disabled",
          },
        ];

        let roles = [
          {
            id: 1,
            name: "Admin",
            description: "Full access to manage users",
            users: 2,
            dateCreated: getCurrentDate(),
            status: "Enabled",
            permissions: {
              canDisableUser: true,
              canAddUser: true,
              canDeleteUser: true,
            },
          },
          {
            id: 2,
            name: "Guest",
            description: "Limited access",
            users: 0,
            dateCreated: getCurrentDate(),
            status: "Disabled",
            permissions: {
              canDisableUser: true,
              canAddUser: true,
              canDeleteUser: true,
            },
          },
        ];

        // Get current date in the required format
        function getCurrentDate() {
          const months = [
            "Jan",
            "Feb",
            "Mar",
            "Apr",
            "May",
            "Jun",
            "Jul",
            "Aug",
            "Sep",
            "Oct",
            "Nov",
            "Dec",
          ];
          const now = new Date();
          const month = months[now.getMonth()];
          const day = now.getDate();
          const year = now.getFullYear();
          return `${month} ${day}, ${year}`;
        }

        // Initialize the application
        function init() {
          loadData();
          renderUsersTable();
          renderRolesTable();
          updateTotalCount();
          setupEventListeners();
        }

        // Setup event listeners
        function setupEventListeners() {
          // Tab switching
          document
            .getElementById("usersTab")
            .addEventListener("click", () => switchTab("users"));
          document
            .getElementById("rolesTab")
            .addEventListener("click", () => switchTab("roles"));

          // Search functionality
          document
            .getElementById("searchInput")
            .addEventListener("input", handleSearch);

          // Add button
          document
            .getElementById("addButton")
            .addEventListener("click", handleAddButton);

          // Form validation
          document
            .getElementById("firstName")
            .addEventListener("input", validateUserForm);
          document
            .getElementById("lastName")
            .addEventListener("input", validateUserForm);
          document
            .getElementById("email")
            .addEventListener("input", validateUserForm);
          document
            .getElementById("role")
            .addEventListener("change", validateUserForm);

          document
            .getElementById("roleName")
            .addEventListener("input", validateRoleForm);
          document
            .getElementById("roleDescription")
            .addEventListener("input", validateRoleForm);
          document
            .getElementById("canDisableUser")
            .addEventListener("change", validateRoleForm);
          document
            .getElementById("canAddUser")
            .addEventListener("change", validateRoleForm);
          document
            .getElementById("canDeleteUser")
            .addEventListener("change", validateRoleForm);

          // Save buttons
          document
            .getElementById("saveUserBtn")
            .addEventListener("click", saveUser);
          document
            .getElementById("saveRoleBtn")
            .addEventListener("click", saveRole);

          // Delete confirmation
          document
            .getElementById("confirmDeleteBtn")
            .addEventListener("click", confirmDelete);

          // Close dropdown when clicking outside
          document.addEventListener("click", function (event) {
            if (!event.target.closest(".dropdown")) {
              closeAllDropdowns();
            }
          });
        }

        // Switch between tabs
        function switchTab(tab) {
          currentTab = tab;

          // Update tab styling
          if (tab === "users") {
            document.getElementById("usersTab").className =
              "tab-active px-4 py-2 cursor-pointer";
            document.getElementById("rolesTab").className =
              "tab-inactive px-4 py-2 cursor-pointer";
            document.getElementById("usersTable").classList.remove("d-none");
            document.getElementById("rolesTable").classList.add("d-none");
            document.getElementById("searchInput").placeholder =
              "Search by name";
            document.getElementById("addButtonText").textContent = "Add User";
          } else {
            document.getElementById("usersTab").className =
              "tab-inactive px-4 py-2 cursor-pointer";
            document.getElementById("rolesTab").className =
              "tab-active px-4 py-2 cursor-pointer";
            document.getElementById("usersTable").classList.add("d-none");
            document.getElementById("rolesTable").classList.remove("d-none");
            document.getElementById("searchInput").placeholder =
              "Search by role name";
            document.getElementById("addButtonText").textContent =
              "Create New Role";
          }

          updateTotalCount();
          document.getElementById("searchInput").value = "";
        }

        // Handle search functionality
        function handleSearch() {
          const searchTerm = document
            .getElementById("searchInput")
            .value.toLowerCase();

          if (currentTab === "users") {
            const filteredUsers = users.filter(
              (user) =>
                `${user.firstName} ${user.lastName}`
                  .toLowerCase()
                  .includes(searchTerm) ||
                user.email.toLowerCase().includes(searchTerm)
            );
            renderUsersTable(filteredUsers);
            document.getElementById("totalCount").textContent =
              filteredUsers.length;
          } else {
            const filteredRoles = roles.filter(
              (role) =>
                role.name.toLowerCase().includes(searchTerm) ||
                role.description.toLowerCase().includes(searchTerm)
            );
            renderRolesTable(filteredRoles);
            document.getElementById("totalCount").textContent =
              filteredRoles.length;
          }
        }

        // Handle add button click
        function handleAddButton() {
          if (currentTab === "users") {
            openUserModal();
          } else {
            openRoleModal();
          }
        }

        // Open user modal
        function openUserModal(userId = null) {
          editingUserId = userId;
          const modal = new bootstrap.Modal(
            document.getElementById("userModal")
          );

          if (userId) {
            const user = users.find((u) => u.id === userId);
            document.getElementById("userModalLabel").textContent = "Edit User";
            document.getElementById("firstName").value = user.firstName;
            document.getElementById("lastName").value = user.lastName;
            document.getElementById("email").value = user.email;
            document.getElementById("role").value = user.role;
            document.getElementById("saveUserBtn").textContent = "Update";
          } else {
            document.getElementById("userModalLabel").textContent =
              "Add New User";
            document.getElementById("userForm").reset();
            document.getElementById("saveUserBtn").textContent = "Add User";
          }

          validateUserForm();
          modal.show();
        }

        // Open role modal
        function openRoleModal(roleId = null) {
          editingRoleId = roleId;
          const modal = new bootstrap.Modal(
            document.getElementById("roleModal")
          );

          if (roleId) {
            const role = roles.find((r) => r.id === roleId);
            document.getElementById("roleModalLabel").textContent =
              "Update Role";
            document.getElementById("roleName").value = role.name;
            document.getElementById("roleDescription").value = role.description;
            document.getElementById("canDisableUser").checked =
              role.permissions.canDisableUser;
            document.getElementById("canAddUser").checked =
              role.permissions.canAddUser;
            document.getElementById("canDeleteUser").checked =
              role.permissions.canDeleteUser;
            document.getElementById("saveRoleBtn").textContent = "Update";
          } else {
            document.getElementById("roleModalLabel").textContent =
              "Create New Role";
            document.getElementById("roleForm").reset();
            document.getElementById("canDisableUser").checked = true;
            document.getElementById("canAddUser").checked = true;
            document.getElementById("canDeleteUser").checked = true;
            document.getElementById("saveRoleBtn").textContent = "Create";
          }

          validateRoleForm();
          modal.show();
        }

        // Validate user form
        function validateUserForm() {
          const firstName = document.getElementById("firstName").value.trim();
          const lastName = document.getElementById("lastName").value.trim();
          const email = document.getElementById("email").value.trim();
          const role = document.getElementById("role").value;
          const saveBtn = document.getElementById("saveUserBtn");

          // Email validation
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          const emailError = document.getElementById("emailError");

          if (email && !emailRegex.test(email)) {
            emailError.textContent = "Please enter a valid email address";
            emailError.style.display = "block";
            document.getElementById("email").classList.add("is-invalid");
          } else {
            emailError.style.display = "none";
            document.getElementById("email").classList.remove("is-invalid");
          }

          // Check if all fields are filled and email is valid
          const isValid =
            firstName && lastName && email && role && emailRegex.test(email);

          if (isValid) {
            saveBtn.className = "btn btn-primary-active";
            saveBtn.disabled = false;
          } else {
            saveBtn.className = "btn btn-primary-inactive";
            saveBtn.disabled = true;
          }
        }

        // Validate role form
        function validateRoleForm() {
          const roleName = document.getElementById("roleName").value.trim();
          const roleDescription = document
            .getElementById("roleDescription")
            .value.trim();
          const hasPermissions =
            document.getElementById("canDisableUser").checked ||
            document.getElementById("canAddUser").checked ||
            document.getElementById("canDeleteUser").checked;
          const saveBtn = document.getElementById("saveRoleBtn");

          const isValid = roleName && roleDescription && hasPermissions;

          if (isValid) {
            saveBtn.className = "btn btn-primary-active";
            saveBtn.disabled = false;
          } else {
            saveBtn.className = "btn btn-primary-inactive";
            saveBtn.disabled = true;
          }
        }

        // Save user
        function saveUser() {
          const firstName = document.getElementById("firstName").value.trim();
          const lastName = document.getElementById("lastName").value.trim();
          const email = document.getElementById("email").value.trim();
          const role = document.getElementById("role").value;

          if (editingUserId) {
            // Update existing user
            const userIndex = users.findIndex((u) => u.id === editingUserId);
            users[userIndex] = {
              ...users[userIndex],
              firstName,
              lastName,
              email,
              role,
            };
          } else {
            // Add new user
            const newUser = {
              id: Date.now(),
              firstName,
              lastName,
              email,
              role,
              dateAdded: getCurrentDate(),
              status: "Active",
            };
            users.push(newUser);
          }

          saveData();
          renderUsersTable();
          updateTotalCount();
          bootstrap.Modal.getInstance(
            document.getElementById("userModal")
          ).hide();
        }

        // Save role
        function saveRole() {
          const roleName = document.getElementById("roleName").value.trim();
          const roleDescription = document
            .getElementById("roleDescription")
            .value.trim();
          const permissions = {
            canDisableUser: document.getElementById("canDisableUser").checked,
            canAddUser: document.getElementById("canAddUser").checked,
            canDeleteUser: document.getElementById("canDeleteUser").checked,
          };

          if (editingRoleId) {
            // Update existing role
            const roleIndex = roles.findIndex((r) => r.id === editingRoleId);
            roles[roleIndex] = {
              ...roles[roleIndex],
              name: roleName,
              description: roleDescription,
              permissions,
            };
          } else {
            // Add new role
            const newRole = {
              id: Date.now(),
              name: roleName,
              description: roleDescription,
              users: 0,
              dateCreated: getCurrentDate(),
              status: "Enabled",
              permissions,
            };
            roles.push(newRole);
          }

          saveData();
          renderRolesTable();
          updateTotalCount();
          bootstrap.Modal.getInstance(
            document.getElementById("roleModal")
          ).hide();
        }

        // Check if dropdown should be dropup
        function shouldUseDropup(element) {
          const rect = element.getBoundingClientRect();
          const windowHeight = window.innerHeight;
          return rect.bottom > windowHeight - 200; // If less than 200px from bottom
        }

        // Render users table
        function renderUsersTable(userList = users) {
          const tbody = document.getElementById("usersTableBody");
          tbody.innerHTML = "";

          userList.forEach((user, index) => {
            const row = document.createElement("tr");
            row.className = "border-bottom";
            row.style.borderColor = "#b0b3b5";

            const isDisabled = user.status === "Disabled";
            const isSuperAdmin = user.role === "Super Admin";

            row.innerHTML = `
                  <td class="py-3" style="width: 20%;">${user.firstName} ${
              user.lastName
            }</td>
                  <td class="py-3" style="width: 25%;">${user.email}</td>
                  <td class="py-3" style="width: 15%;">${user.role}</td>
                  <td class="py-3" style="width: 15%;">${user.dateAdded}</td>
                  <td class="py-3" style="width: 15%;">
                      <span class="status-${user.status.toLowerCase()}">${
              user.status
            }</span>
                  </td>
                  <td class="py-3" style="width: 10%;">
                      <div class="dropdown">
                          <button class="btn btn-sm ${
                            isSuperAdmin ? "action-button-disabled" : ""
                          }"
                                  type="button"
                                  ${
                                    isSuperAdmin
                                      ? ""
                                      : 'data-bs-toggle="dropdown"'
                                  }
                                  aria-expanded="false"
                                  ${isSuperAdmin ? "disabled" : ""}
                                  id="userDropdown${user.id}">
                              <i class="fas fa-ellipsis-v text-muted"></i>
                          </button>
                          ${
                            !isSuperAdmin
                              ? `
                          <ul class="dropdown-menu ${
                            index >= userList.length - 2
                              ? "dropdown-menu-end"
                              : ""
                          }">
                              <li><a class="dropdown-item"  th:href="@{/merchant/userDetails}" >View Details</a></li>
                              <li><a class="dropdown-item" href="#" onclick="editUser(${
                                user.id
                              })">Edit</a></li>
                              <li>
                                  <a class="dropdown-item d-flex justify-content-between align-items-center" href="#" onclick="event.preventDefault();">
                                      Disable User
                                      <label class="toggle-switch ms-2">
                                          <input type="checkbox" ${
                                            isDisabled ? "checked" : ""
                                          } onchange="toggleUserStatus(${
                                  user.id
                                }, event)">
                                          <span class="toggle-slider"></span>
                                      </label>
                                  </a>
                              </li>
                              <li><a class="dropdown-item text-danger" href="#" onclick="deleteUser(${
                                user.id
                              })">Delete User</a></li>
                          </ul>
                          `
                              : ""
                          }
                      </div>
                  </td>
              `;
            tbody.appendChild(row);
          });
        }

        // Render roles table
        function renderRolesTable(roleList = roles) {
          const tbody = document.getElementById("rolesTableBody");
          tbody.innerHTML = "";

          roleList.forEach((role, index) => {
            const row = document.createElement("tr");
            row.className = "border-bottom";
            row.style.borderColor = "#b0b3b5";

            const isDisabled = role.status === "Disabled";

            row.innerHTML = `
                  <td class="py-3" style="width: 20%;">${role.name}</td>
                  <td class="py-3" style="width: 30%;">${role.description}</td>
                  <td class="py-3" style="width: 10%;">${role.users}</td>
                  <td class="py-3" style="width: 15%;">${role.dateCreated}</td>
                  <td class="py-3" style="width: 15%;">
                      <span class="status-${role.status.toLowerCase()}">${
              role.status
            }</span>
                  </td>
                  <td class="py-3" style="width: 10%;">
                      <div class="dropdown">
                          <button class="btn btn-sm" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                              <i class="fas fa-ellipsis-v text-muted"></i>
                          </button>
                          <ul class="dropdown-menu ${
                            index >= roleList.length - 2
                              ? "dropdown-menu-end"
                              : ""
                          }">
                              <li><a class="dropdown-item"  th:href="@{/merchant/roleDetails}">View Details</a></li>
                              <li><a class="dropdown-item" href="#" onclick="editRole(${
                                role.id
                              })">Update Role</a></li>
                              <li>
                                  <a class="dropdown-item d-flex justify-content-between align-items-center" href="#" onclick="event.preventDefault();">
                                      Disable Role
                                      <label class="toggle-switch ms-2">
                                          <input type="checkbox" ${
                                            isDisabled ? "checked" : ""
                                          } onchange="toggleRoleStatus(${
              role.id
            }, event)">
                                          <span class="toggle-slider"></span>
                                      </label>
                                  </a>
                              </li>
                              <li><a class="dropdown-item text-danger" href="#" onclick="deleteRole(${
                                role.id
                              })">Delete Role</a></li>
                          </ul>
                      </div>
                  </td>
              `;
            tbody.appendChild(row);
          });
        }

        // Close all dropdowns
        function closeAllDropdowns() {
          const dropdowns = document.querySelectorAll(".dropdown-menu.show");
          dropdowns.forEach((dropdown) => {
            dropdown.classList.remove("show");
          });
        }

        // View user details
        function viewUserDetails(userId) {
          const user = users.find((u) => u.id === userId);
          localStorage.setItem("viewUser", JSON.stringify(user));
          window.open("user-details.html", "_blank");
        }

        // View role details
        function viewRoleDetails(roleId) {
          const role = roles.find((r) => r.id === roleId);
          localStorage.setItem("viewRole", JSON.stringify(role));
          window.open("role-details.html", "_blank");
        }

        // Edit user
        function editUser(userId) {
          openUserModal(userId);
        }

        // Edit role
        function editRole(roleId) {
          openRoleModal(roleId);
        }

        // Toggle user status
        function toggleUserStatus(userId, event) {
          event.stopPropagation();
          const user = users.find((u) => u.id === userId);
          user.status = user.status === "Active" ? "Disabled" : "Active";
          saveData();
          renderUsersTable();
        }

        // Toggle role status
        function toggleRoleStatus(roleId, event) {
          event.stopPropagation();
          const role = roles.find((r) => r.id === roleId);
          role.status = role.status === "Enabled" ? "Disabled" : "Enabled";
          saveData();
          renderRolesTable();
        }

        // Delete user
        function deleteUser(userId) {
          deleteTarget = userId;
          deleteType = "user";
          document.getElementById("deleteText").textContent =
            "Once deleted, you cannot access the user again";
          const modal = new bootstrap.Modal(
            document.getElementById("deleteModal")
          );
          modal.show();
        }

        // Delete role
        function deleteRole(roleId) {
          deleteTarget = roleId;
          deleteType = "role";
          document.getElementById("deleteText").textContent =
            "Once deleted, you cannot access the role again";
          const modal = new bootstrap.Modal(
            document.getElementById("deleteModal")
          );
          modal.show();
        }

        // Confirm delete
        function confirmDelete() {
          if (deleteType === "user") {
            users = users.filter((u) => u.id !== deleteTarget);
            renderUsersTable();
          } else if (deleteType === "role") {
            roles = roles.filter((r) => r.id !== deleteTarget);
            renderRolesTable();
          }

          saveData();
          updateTotalCount();
          bootstrap.Modal.getInstance(
            document.getElementById("deleteModal")
          ).hide();
        }

        // Update total count
        function updateTotalCount() {
          const count = currentTab === "users" ? users.length : roles.length;
          document.getElementById("totalCount").textContent = count;
        }

        // Initialize the application when the page loads
        document.addEventListener("DOMContentLoaded", init);
      </script>
    </div>
  </body>
</html>
